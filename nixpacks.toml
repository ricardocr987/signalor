[phases.setup]
nixPkgs = ['bun']
aptPkgs = ["unzip", "build-essential", "pkg-config", "libcairo2-dev", "libpango1.0-dev", "libjpeg-dev", "libgif-dev", "librsvg2-dev"]
cmds = [
  'bun remove sharp',
  'bun add sharp@0.32.6 --platform=linux --arch=x64 --target=20x'
]

[phases.update]
cmds = ['bun upgrade']
dependsOn = ["setup"]

[phases.build]
cmds = ['bun build --compile --minify-whitespace --minify-syntax --sourcemap --target bun ./src/index.ts --outfile dist/api']

[start]
cmd = 'bun run dev'